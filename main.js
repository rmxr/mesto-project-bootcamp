(()=>{"use strict";function e(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)}var t,n=document.querySelector(".profile__edit-button"),o=(document.querySelectorAll(".popup"),document.querySelectorAll(".popup__close-button")),r=document.querySelector(".popup_function_edit"),c=document.querySelector(".popup_function_add-card"),u=document.querySelector(".popup_function_view-image"),a=document.querySelector(".popup_function_avatar-change"),i=document.querySelector(".popup_function_card-delete-confirm"),l=document.querySelector(".profile__add-button"),s=document.querySelector(".profile__avatar"),d=document.querySelector(".profile__name"),p=document.querySelector(".profile__description"),f="",_={},m="",v=document.querySelector(".popup__form_function_edit"),y=document.querySelector(".popup__form_function_add-card"),h=document.querySelector(".popup__form_function_avatar-change"),S=document.querySelector(".popup__form_function_card-delete-confirm"),q=y.querySelectorAll("input"),b=v.querySelector(".popup__form-item_profile-name"),E=v.querySelector(".popup__form-item_profile-description"),g=y.querySelector(".popup__form-item_card-name"),L=y.querySelector(".popup__form-item_card-source"),k=h.querySelector(".popup__form-item_avatar-source"),C=document.querySelector("#cards__template").content,A=document.querySelector(".cards__container"),x=u.querySelector(".popup__image"),T=u.querySelector(".popup__image-caption"),w=Array.from(document.querySelectorAll(".popup")),U=document.querySelector(".popup__image-container"),D=Array.from(document.querySelectorAll(".popup__container")).concat(U),P={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-4",headers:{authorization:"c361903a-6f02-478d-80a9-7b9e8ed8c1ed","Content-Type":"application/json"}};function B(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}function N(e){e.classList.add("popup_opened"),document.addEventListener("keydown",j)}function O(e){e.closest(".popup").classList.remove("popup_opened"),document.removeEventListener("keydown",j)}function j(e){"Escape"===e.key&&O(document.querySelector(".popup_opened"))}function H(e){e.dispatchEvent(new Event("input",{bubbles:!0}))}function J(e){var t;e.preventDefault(),(t=m,fetch("".concat(P.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:P.headers}).then((function(e){return B(e)}))).then((function(){return I()})).finally((function(){S.removeEventListener("submit",J),O(e.target)}))}function M(e,t,n){t.textContent=e?"Сохранение...":n}function z(e){d.textContent=e.name,p.textContent=e.about,s.style.backgroundImage="url(".concat(e.avatar,")")}function I(){A.innerHTML="",fetch("".concat(P.baseUrl,"/cards"),{headers:P.headers}).then((function(e){return B(e)})).then((function(e){e.forEach((function(e){!function(e){var t=function(e){var t=C.querySelector(".cards__item").cloneNode(!0),n=t.querySelector(".cards__like-button"),o=t.querySelector(".cards__delete-button"),r=t.querySelector(".cards__image"),c=t.querySelector(".cards__like-counter"),a=e.likes.some((function(e){return e._id===f}));return r.src="".concat(e.link),r.alt="".concat(e.name),c.textContent=e.likes.length,t.querySelector(".cards__title").textContent="".concat(e.name),n.addEventListener("click",(function(){return function(e,t,n){(function(e,t){var n=!0===e?"DELETE":"PUT";return fetch("".concat(P.baseUrl,"/cards/likes/").concat(t),{method:n,headers:P.headers}).then((function(e){return B(e)}))})(_["".concat(e)],e).then((function(o){n.textContent=o.likes.length,t.classList.toggle("cards__like-button_active"),_["".concat(e)]=!_["".concat(e)]}))}(e._id,n,c)})),r.addEventListener("click",(function(){return t=e.link,n=e.name,x.src=t,x.alt=n,T.textContent=n,void N(u);var t,n})),a&&n.classList.add("cards__like-button_active"),e.owner._id!==f&&o.remove(),e.owner._id===f&&o.addEventListener("click",(function(){return t=e._id,m=t,S.addEventListener("submit",J),void N(i);var t})),_["".concat(e._id)]=a,t}(e);A.append(t)}(e)}))}))}n.addEventListener("click",(function(){b.value="".concat(d.textContent),E.value="".concat(p.textContent),H(b),H(E),N(r)})),v.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=e.currentTarget.querySelector(".popup__save-button");M(!0,o),(t="".concat(b.value),n="".concat(E.value),fetch("".concat(P.baseUrl,"/users/me"),{method:"PATCH",headers:P.headers,body:JSON.stringify({name:"".concat(t),about:"".concat(n)})}).then((function(e){return B(e)}))).then((function(e){return z(e)})).catch((function(e){console.log(e)})).finally((function(){return M(!1,o,"Сохранить")})),O(e.target)})),y.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=e.currentTarget.querySelector(".popup__save-button");M(!0,o),(t=g.value,n=L.value,fetch("".concat(P.baseUrl,"/cards"),{method:"POST",headers:P.headers,body:JSON.stringify({name:"".concat(t),link:"".concat(n)})}).then((function(e){return B(e)}))).then((function(){I(),O(e.target),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){return M(!1,o,"Создать")}))})),h.addEventListener("submit",(function(e){e.preventDefault();var t,n=e.currentTarget.querySelector(".popup__save-button");M(!0,n),(t="".concat(k.value),fetch("".concat(P.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:P.headers,body:JSON.stringify({avatar:"".concat(t)})}).then((function(e){return B(e)}))).then((function(e){return z(e)})).catch((function(e){console.log(e)})).finally((function(){return M(!1,n,"Сохранить")})),O(e.target),e.target.reset()})),l.addEventListener("click",(function(){!function(e){q.forEach((function(e){return H(e)})),N(e)}(c)})),s.addEventListener("click",(function(){N(a)})),fetch("".concat(P.baseUrl,"/users/me"),{headers:P.headers}).then((function(e){return B(e)})).then((function(e){var t;z(e),t=e._id,f=t,I()})).catch((function(e){console.log(e)})),D.forEach((function(e){e.addEventListener("mousedown",(function(e){return e.stopPropagation()}))})),t={formSelector:".popup__form",inputSelector:".popup__form-item",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_type_inactive",inputErrorClass:"popup__form-item_type_error",errorClass:"popup__input-error_visible"},document.querySelectorAll(t.formSelector).forEach((function(n){!function(t,n){var o=n.inputSelector,r=n.submitButtonSelector,c=n.inactiveButtonClass,u=n.inputErrorClass,a=n.errorClass,i=Array.from(t.querySelectorAll(o)),l=t.querySelector(r);e(i,l,c),i.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.textContent="",r.classList.remove(o)}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(t,n,u,a),e(i,l,c)}))}))}(n,t)})),o.forEach((function(e){e.addEventListener("click",(function(e){return O(e.target)}))})),w.forEach((function(e){e.addEventListener("mousedown",(function(e){return O(e.target)}))}))})();